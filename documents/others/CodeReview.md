# 培养Code Review文化

每个程序员都应该Review或者被别人Reivew过代码，至少都听说过有人会这么做。但不是每个程序员都知道如何参与到Code Review中。在这份文档中我们会就这个问题展开讨论。

## Code Review的目标

Code review是几乎所有科技公司开发流程中重要的一环。
那么为什么要做Code review，它为什么很重要？

* **分享知识**. 项目组中每个人的知识结构必然不一样，通过Code review将每个人的知识分享出来可以帮组整个项目组提高技术能力。
* 通过Code review能很容易分辨出同事们中谁是**技术专家，大牛**, 当然这个人或许就是你. 所以它也是获得成就感和自豪感的一种方式。
* **提高代码的质量**：别人可以帮你发现一些不小心出现的错误，代码结构上的问题。代码风格更加一致，减少代码维护的成本。

## Code Review的流程

* 代码可以由一人或者多人Review
  * 指定一个你认为合适的人为你做Code review。
  * 每一位组员都可以参与到Code review的流程中。
* 分支必须经过Review才可以合并
  * 不能带着质量低下的代码发布产品，一时的妥协后患无穷。
  * Code review可能会来回很多次直到代码达到普遍可以接收的标准。
* 有必要的话要求在Code Review结束后要求QA做回归测试。
* 整个流程一般会花费1到2天。
  * 给Review代码同事一到两天的时间，别忘了每天第二天早上提醒他一下。

## 如何提高Code Review的质量

### Review代码的人必须认同Code Review的价值

没有人愿意花时间Review了代码，但是提出的意见却不被重视。

* 代码作者必须修正被指出的问题
  * 对于有争议的问题可以展开讨论，忽略别人的意见是对别人工作的不尊重。
* 项目负责人应该坚定立场：拒绝低质量的代码
  * 代码质量的底线需要项目负责人极力维护
  * 代码质量低的问题往往只会在引入Code Review的初期被发现，开发者会很快把自己提高到一个高的标准，整个项目的代码质量也会随之提高。

### 不要浪费时间在不重要的事情上

* 能自动化的都自动化
  * 例如代码格式化，括号的对齐，构造函数参数个数等可以由代码静态检查工具搞定，就不要花时间Review了。一定程度的代码风格差异是可以接受的。
  * 选择适合项目需求的静态检查工具规则，去掉那些过时的和有争议的部分。
* 提交Merge Request的时候提供足够的信息，让Review Code的人能明白你的意图。
* Review Code的人应该把注意力放在业务逻辑上

#### 一份Merge Request模版供参考

    概述

    * 对Merge Request的简单介绍
    * 声明Merge Request的类型 (Bug fix, Improvement, Feature Implementation, Conceptioinal solution等)
    * 如果有的话的列出相关的Merge Request方便别人理解上下文

    改动列表

    * 列出次Merge Request的改动内容

### 代码Reviewer应该关注代码的实现，可读性，和可维护性

* 换做你你会如何去解决问题
  * 会和代码作者采用同样的方法吗，为什么？
  * 你的实现会不会考虑更多的情况。

* 是不是可以通过抽象来简化代码实现，避免冗余。
  * 重复的和相似的代码总是可以通过抽象来简化

* 是否代码库中已经有类似的代码解决类似的问题。
  * 有时代码作者并不知道或者忘记代码库中已经存在解决相似问题的方法或者类库

* 你是不是能在合理的时间范围内读懂被Review的代码
  * 代码命名风格是否和项目组的风格一致。
  * 代码是否符合低耦合，高内聚的原则。
  * 流程逻辑是否能做到自我描述。

* 被Review的代码是否符合项目组的代码规范和风格

* Review对应的测试用例
  * 是否写了单元测试用例，如果没有写，为什么？
  * 测试用例能不能通过持续集成，或者导致持续集成不稳定。

* 代码是否向后兼容（公共类库）
  * 不向后兼容的话代价是什么，调用方是否要跟着升级代码？

* 有没有文档需要被更新

* 尽量快的对需要你Review的Merge Request作出响应
  * 拖慢Code review的流程有可能导致项目延期。

* 一定要读懂你Review的代码，对你和你的队友负责
  * 当你读懂了别人的代码逻辑，你也就变成了它的作者之一。

* 提出你的反馈
  * 请友善地写下你的意见，对码不对人。
  * 泛泛的意见没有任何意义，你的反馈应该越详细越好，目的是让代码作者明白你的想法和思路。

* 利用好Code Review的机会去和大家分享你的知识，并从中学习。

### 代码作者应当配合别人Review Code

* 代码分支应当小到可以被Review
  * 大的代码分支基本上没办法Review。假设别人要求你帮忙Review一个上千行代码，数十个文件的改动，你一定会当场奔溃。一般500行代码改动是比较合理的。对于添加新的功能，1000行左右也是可以接受的。
* 代码给别人Review之前先自己检查，没有通过持续集成测试的代码也不应该让别人Review。
  * 一定不要浪费别人的时间
* 修复或答复每一条别人给你提出的意见。
  * 有争议的地方可以展开讨论，最终达成一致。
* 把Code Review当成一次从你的同事身上学习的机会
  * 让别人检查你的代码绝对是对你编码技巧提高最好的机会。
  * 平常心看待别人对你的代码提出的意见，对码不对人。

## 总结

Code Review应当是互利的。假如你愿意开诚布公地和你的同事分享知识和看法，他们也会愿意说出他们的真实想法。代码是我们自己写的，也将是我们自己去维护它。高质量的代码在为你赢得好名声的同时也会节省你维护它的时间，从而有时间去做更有趣的事情。
