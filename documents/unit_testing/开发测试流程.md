# 开发测试流程

## 介绍

引入开发测试的流程的最终目标是提高代码质量，减少线上bug的出现。通过自动化的执行测试用例，统计测试结果, 快速的测试环境构建，提高开发和测试的效率。

## Workflow

### 单元测试

给代码编写单元测试是软件开发中的好实践，绝大多数开发者应该都同意这个观点。 但开发者也普遍都存在疑问：单元测试该如何开展，测试做多细，在面对紧迫的开发任务时来不及写测试怎么办。

关于单元测试的相关问题可以参考阅读下列文档:

[单元测试规范](https://git.youle.game/TC/TSD/DevOps/dev_tools/wikis/technical_manual/test-model)
[常见问题](https://git.youle.game/TC/TSD/DevOps/dev_tools/wikis/technical_manual/test-problem)
[TestNG & PowerMock](https://git.youle.game/dk/dk-server-group/dk_server/wikis/dk-server-test)
[Java单元测试最佳实践](https://howtodoinjava.com/best-practices/unit-testing-best-practices-junit-reference-guide/#tips)


#### 单元测试也是功能的一部分

需要开发者转变观念的是，单元测试其实也是功能的一部分。单元测试可以第一时间验证开发者编写的功能是否符合预期，而且当感觉编写单元测试比较困难时应当反推功能代码的设计是否合适，来驱动代码的重构提高代码质量。配备了单元测试的功能，代码是经常需要修改和维护的。配备了单元测试的功能可以有信心地应对这些变化。只要代码修改后依然能通过所有的测试，就可以保证不会破坏原有的功能，极大程度上减少Bug的发生。
好的实践是在编写功能代码的同时就写下相应的单元测试，此时开发的细节印象深刻，写测试的速度和质量也会比事后补救要高很多。

#### 代码要通过代码风格/静态代码检查

Java: PMD bestpractice
Python: PythonCodeStyle (Pep8)

代码push到远端（remote）的时候会触发代码风格/静态代码检查。检查结果会通过钉钉通知。检查失败的话需要开发者修复这些问题指导通过。可以点击钉钉通知连接，打开Violation选项来查看失败的细节。

为了方便开发者能第一时间解决这些问题，我们提供了工具可以在本地提交代码（git commit）时就触发代码风格/静态代码检查. 依照[Code Lint](https://git.youle.game/TC/TSD/DevOps/dev_tools) README完成工具的本地安装。

工具提供的检查规则并不一定适合和满足所有的项目。 在使用过程中需要对规则调整和扩充的需求可以在[Code Lint](https://git.youle.game/TC/TSD/DevOps/dev_tools/issues)看板上创建Issue。

#### Never Break CI

在开发过程中难免会影响到现有的功能，单元测试会失败从而捕获这些改动。开发者应当第一时间修复这些失败的单元测试用例，禁止将测试失败的代码合并到协同工作的分支。（协同工作的分支可能是master，也可能是项目组约定的任意分支）

#### Code Review 和 Merge Request

我们希望项目组开展Code Review。关于Code Review的必要性和好处互联网上有大量的资料可以阅读，此处我们不再赘述。关于Code Review的实践，推荐阅读[Code Review](https://git.youle.game/TC/documents/wikis/%E5%9F%B9%E5%85%BBcode-review%E7%9A%84%E6%96%87%E5%8C%96)， 文档的原作者是Nodejs的主要贡献者之一，有丰富的开源项目合作经验和Code Review经验。

代码push到远端（remote）后，在其gitlab仓库上创建一个Merge Request。根据项目组的要求把MR的连接通过钉钉告知你的同事。

#### Bug Fix

发现了Bug怎么办？毫无疑问要安排时间和人力去修复Bug。现在我们提出了更高的要求：

1. 添加单元测试去覆盖出现Bug的代码逻辑。
2. 为修复Bug而引入的新代码也要有单元测试覆盖。

这样做的好处是我们可以明确的知道修复过的Bug不会因为将来的代码改动而回归，也可以将为修复Bug而添加的新代码引入更多Bug的几率控制在最低。

### 接口测试

* 施工中

### 集成测试

* 施工中
