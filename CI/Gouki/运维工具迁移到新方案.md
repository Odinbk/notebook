# 运维工具迁移到新方案

## CMDB

原来Vega使用的老CMDB存在以下问题：

1. 不能支持公司游戏项目新的游戏架构：混服(Vega, Gouki)，多区多服(TKW), 不分区服(YK)。 不支持新的游戏架构指的是无法在CMDB中描述各种类型的服务(GameServer, BattleServer, WorldServer)和服务器之间的拓补关系。
2. 添加新功能，新的数据对象有很大的开发工作量，很容易出Bug。
3. API支持弱，可编程性差： 仅有读取部分资源的API，没有写API。 无法完成批量的资源CRUD操作。

带着以上问题，技术支撑部调研了一些开源的技术方案，结合我们实际和腾讯合作紧密的情况，最后选择了腾讯的开源版蓝鲸CMDB。
蓝鲸CMDB在满足一般的资产和配置管理的需求上，可以很好的解决以上问题。目前，GRAN，TKW，JAP等项目已经都接入了蓝鲸CMDB。 GRAN已经使用了近一年的时间，TKW也全面完成了从老CMDB到蓝鲸CMDB迁移的过程。 配套的相关系统如： WallE，天梯，GM3+， CDKey也完成了蓝鲸CMDB的适配。 Zeus，Report系统也会在近期完成适配。

## 运维工具

运维工具代码仓库目前是每个项目单独维护独立的仓库，但运维仓库的功能大同小异：超过90%的代码是完全相同，仅仅是在某些配置读取的路径上略有不同。为了解决这个问题，我们设计开发了统一的运维管理工具库：

1. 把功能相同的部分抽象出来，统一开发维护。同时也保留了一定的弹性，每一块功能都可以根据不同项目的实际需求通过配置的方式更换。
2. 我们为运维工具库添加了足够多的单元测试（80%覆盖率）保证代码的质量，降低代码变更导致出现Bug的几率。
3. 对ZooKeeper中的配置路径做了统一的规划：技术支撑部负责的部分如，version，cmdb等配置不同项目组使用统一设计的配置管理；项目组负责的配置如meta可以自行设计和控制。
4. 对职责边界做了明确的划分：服务行为管理（启服，停服等）可以通过配置的方式由项目组完成，游戏开发可以专注在项目关心的部分而不用去理解运维管理的数据（CMDB的配置，版本发布配置）的细节。

## 迁移成本

* Gouki项目处于早期，CMDB配置的迁移成本很低，由运维负责完成迁移。
* 运维工具迁移，需要项目组后端配合完成部分服务中读取ZooKeeper数据的路径变更，从TKW迁移的过程来看不会很麻烦。
* 需要梳理Vega工具仓库中具备，但是新方案中不具备的功能点。
* Vega项目World服务中众多的子功能和服务器之间的拓补关系如何描述和配置。
