# 后端模块热更新

理论上对线上环境的代码，配置更新都应该以有迹可循的方式来操作，例如版本发布。但是实际的情况中需要有对线上环境直接干预的能力来紧急修复线上问题，快速止损，避免问题扩大。例如，调整数值表控制道具的获取比率； 热加载java class，修复问题等。此类操作我们称之为热更新。

出于统一流程和资源复用的原因，WallE上提供了数值表，Meta配置的热更新功能。下面详细介绍一下功能的设计和使用方法。

## 详细设计

### 热更新流程

1. 开发在热更新的分支上修改代码，提交，打Tag触发CI。
2. CI成功后，会把相应模块的Module Tag注册到WallE，选择对应的Module Tag，指定要热更新的文件名（支持最小粒度为文件，class。不支持如数值表对一行的修改。），不指定文件名的话，CI产出中的所有文件都会写入到热更新包。开始热更新任务。
3. WallE创建热更新Jenkins任务：
    * 从Resouce Center下载步骤2中Module Tag指定的资源
    * 拆开CI资源产出，提取步骤2中指定的文件，创建热更新包，包的格式和后端包一致。eg. `vega/version/{module_name}/{online_module_tag}/{content}`。注意包的路径中并不是步骤2热更新的Module Tag，而是当前线上版本的Module Tag。这样热更新包直接推送到线上，解压缩，就增量覆盖了旧资源，完成热更新目的。

4. 天梯流程发布热更新包



### 优点

* 构建热更新包的环境和构建后端包完全一致，不用考虑软件版本，编译环境差异导致的不可以预知的问题。
* 体验一致的发布流程: WallE构建热更新包，天梯发布热更新。

## 使用方法
