# DevOps项目组组周报

## Walle

### Vega CI/CD接入

* 除审核服流程外，其他功能接入完成。
* Vega天梯流程梳理完成，审核服的验收测试下周由DevOps执行，Vega QA验收。
* Vega在打包流程调整完毕后需要迁移到正式环境的Walle和Jenkins。
* RC缓存迁移方案讨论确定
  * mtool相关代码改动完成。
  * walle中添加了获取缓存数据库的接口。
  * 下周mtool容器化，接入CI，联调整个流程。

### 对接腾讯IDC

* 打包脚本中对CMDB的依赖已经完全移除, 生成cmdb相关配置的部分迁移到了天梯流程中。
* 打包脚本仓库(pipeline)仅保留了起停服的脚本。代码重构，测试完成。
* 天梯脚本适配腾讯CMDB数据格式开发，测试完成。重构了访问zookeeper的接口，今后对zookeeper的操作应该扩展现有的接口，避免重复造轮子。
* 天梯脚本功能整理，按照功能分组，希望能达到天梯流程更准确，使用更方便的目标。
* Vega天梯流程整理完成。
* 服务器meta配置快速更新的需求可以通过仅发布服务端包实现。
* 用于打包流程，获取线上客户端版本信息的Online Version Service改造。
  * Online Version Service下线，功能迁移到其他线上服务中。
  * DK项目组使用notice服务获取线上版本，功能测试可用，Walle简单调整代码，配置数据就可用。
  * Vega项目组使用VMS服务获取线上版本，功能需要开发。
  * Walle支持手工传入线上版本打包的功能，应对VMS/Notice服务不可用的情况。
  * 以上相关功能已经开发完成上线，下周一下线Online Version Service，移除相关监控项。

## Walle功能开发

* Walle提供API为下游任务提供敏感参数，相关代码修改。-- 开发测试。
* Walle根据不同项目从VMS/Notice获取线上版本，将线上版本缓存。在获取线上版本失败的情况下，允许用户设置最小可更新版本。
* DK Payment模块接入CI。

## 内部项目容器化部署

* 本周完成了天梯的容器化部署，Staging环境搭建。
* 后续完成DevOps内部其他项目，PDG项目容器化部署，Staging环境。

## 监控

* 调研和制定Prometheus监控指标，Label规范。
* 调研zk, mongodb, redis和rabbit mq监控方案, 部署上线。

## 容灾

* [Jenkins备份恢复方案](https://git.youle.game/TC/TSD/OPS/documents/wikis/Jenkins%20%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D)。
* [openldap纷纷恢复方案](https://git.youle.game/TC/TSD/OPS/documents/wikis/Openldap%20%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D)

### 相关文档

* [Jenkins任务组织](https://git.youle.game/TC/TSD/DevOps/dune/wikis/jenkins_authorization)
* [CI/CD系统接入Step By Step文档](https://git.youle.game/TC/TSD/DevOps/dune/wikis/integrate_walle_step_by_step)
* [GameStatic/Patch](https://git.youle.game/TC/TSD/DevOps/dune/wikis/Release-Note-v0.1.2)
* [服务器端灰度/审核服方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%90%8E%E7%AB%AF%E6%96%87%E6%A1%A3/appstore_review_and_gray)
* [客户端灰度发布方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%89%8D%E7%AB%AF%E6%96%87%E6%A1%A3/gray-server)
* [客户端审核服方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%89%8D%E7%AB%AF%E6%96%87%E6%A1%A3/apple-review-version)
* [svn备份及恢复](https://git.youle.game/TC/TSD/OPS/documents/wikis/%E6%96%B0SVN%20%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D)
* [git备份及恢复](https://git.youle.game/TC/TSD/OPS/documents/wikis/GitLab%20%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D)
* [jenkins备份及恢复](https://git.youle.game/TC/TSD/OPS/documents/wikis/Jenkins%20%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D)
* [openldap备份及恢复](https://git.youle.game/TC/TSD/OPS/documents/wikis/Openldap%20%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D)

 