# DevOps项目组周报

## 本周工作

### Vega

* T-IDC-Art集群搭建、初始化
* 服务端压力测试
  * 登陆排队
  * GVE、联盟创建等业务功能
  * 配合项目组解决压测发现的问题
* 调整RabbitMQ的HA策略，由ha=all调整为ha=exactly，原有的策略扩容节点性能提升不高
  * 压测集群测试调整后MQ的性能
  * 调整T-IDC-Daily集群的MQ策略，由项目组回归验收功能，正常测试各个业务即可
* world meta优化，支持同一个主业务不同子业务落在不同服务器上面
* PR2相关config、assets等CICD接入处理，svn权限限制

### TKW

* 在轻测环境上调查 mongo 清档按 table 删除依旧有角色数据未正确删除的问题。
  * 多次测试未能复现按表清档还有残留 role 的问题
* 和项目组就 tkw 各集群天梯流程同步和调整
  * 导出个集群的天梯步骤的定义，提交项目组。
  * 暂定本周调整testing 添加 battle 模块，其他集群轻测结束后以 轻测集群天梯流程为基准调整 cmdb和 天梯

### YK

* YK线上服务器缩容降配。
* 修YK快照执行时间未按照时区配置触发的问题。原因是crontab有独立的时区设置，并没有读取操作系统的时区设置。
* 配合调查线上客户端连接Global超时的问题：基础设施包括网络，负载均衡器，主机负载等均在正常值内。项目组后续调查，尚未有反馈。

### DevOps

* 天梯适配蓝鲸CMDB API存在Python版本不兼容的问题，本周升级了天梯的django框架版本到支持Python3.6+的 2.2版本。测试部署上线。
* 天梯适配蓝鲸CMDB API，完成开发。
* K8s自建集群迁移到阿里云托管集群，本周有YK上线和Vega测试，相关项目如WallE，CMDB，Ucenter推迟到下周上线。
* 整理蓝鲸对服务器创建的需求，抽象可以复用的Terraform modules

* Thomas Bug修复：创建FTP连接失败时没有dingding消息通知。
* Thomas 通知消息格式优化：1. 显示包对应的md5值。2. 整合多条通知消息为一条。3. 消息体中显示部署位置名称。
* Pillar，Thomas等项目接入CI。
* Pillar 支持本地调试，不依赖服务器部署环境，方便开发测试。
* Pillar 支持消费的配置文件携带版本，版本匹配的Pillar和配置文件才能工作。
* 讨论确认Terraform在运维工具链中的职责：跨云管理云上的资源，不和业务产生直接关系。未来按照这个思路开发，机器购买后如何调整，交由独立的理解业务的脚本自动化同步到CMDB。
* WallE，天梯，CMDB，UCenter，OMTools，鹰眼等项目迁移至新的阿里云K8s集群。迁移过程中出现过若干问题，已经修复记录，本周在组内分享讨论。
