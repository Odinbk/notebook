# DevOps项目组组周报

## Walle

### Vega CI/CD接入

* 希望放开Assets模块CI的触发条件限制，计划先验证Assets增量构建，评估执行时间和性能，再决定要加打包机，TPlicence还是在机制上做调整。
* 项目组提出需求，提供Walle产生安装包，更新包的逻辑说明；VMS状态码以及状态迁移规则说明。-- Walle更新包逻辑文档完成，VMS相关说明需要王贤蛟确认。
* 游戏的‘前往安装下载’可以跳转到最新可用的强更包下载地址，Walle配合提供last下载地址。-- 开发完成，测试确认。

### TKW CI/CD接入

TKW CI/CD对接目前的状况是：

* CI遇到的问题基本上处理完毕，比较稳定。
* 可以打出安装包。
* 天梯脚本已经创建，联调完成。VMS，Notice，Global无状态服务同时支持容器化和虚拟机部署。
* 热更新逻辑开发中，计划在9月21日（周六）发布第一版本。

### YK CI/CD接入

YK CI/CD接入目前的状况是：

* 前后端CI都已经接入完成
* 后端可以通过Walle构建后端包
* 后端天梯流程，起停服脚本等都已创建，调试完成。
* 由于前后端对接还未完成，还不能通过Walle构建出前后端配合的可用包。
* YK目前还是用自己维护的打包脚本打包，CI/CD接入还没有产生生产力。
* YK的热更新（reslib）计划在TKW完成热更逻辑后开始接入。

### DK CI/CD接入

* 支持配置两个CDN地址，当首要CDN支持故障不可用时，从备用CDN下载更新。托马斯脚本改造，支持同时上传包到多个地址。

## 本周工作

* 设计实现CI任务在jenkins中排队/丢弃/保持等逻辑收集需求，简单设计。下周开始开发工作。
* Vega提的跳转强更连接，更新逻辑说明文档完成，测试确认后交付。
* 天梯工具优化，记忆用户选择。开发完成，已上线。
* 日本区K8s集群采购，建设。集群搭建完毕，部署了简单的服务验证通过。

## 下周计划

* jenkins gateway开发实现。
* 天梯按用户分组，不同用户权限可见的流程不同。
* 黑帮官网迁移到日本区K8s集群，topjoy官网日本区K8s部署。

### 相关文档

* [Jenkins任务组织](https://git.youle.game/TC/TSD/DevOps/dune/wikis/jenkins_authorization)
* [CI/CD系统接入Step By Step文档](https://git.youle.game/TC/TSD/DevOps/dune/wikis/integrate_walle_step_by_step)
* [GameStatic/Patch](https://git.youle.game/TC/TSD/DevOps/dune/wikis/Release-Note-v0.1.2)
* [服务器端灰度/审核服方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%90%8E%E7%AB%AF%E6%96%87%E6%A1%A3/appstore_review_and_gray)
* [客户端灰度发布方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%89%8D%E7%AB%AF%E6%96%87%E6%A1%A3/gray-server)
* [客户端审核服方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%89%8D%E7%AB%AF%E6%96%87%E6%A1%A3/apple-review-version)
