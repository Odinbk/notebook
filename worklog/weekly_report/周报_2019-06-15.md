# DevOps项目组组周报

## Walle

### Vega CI/CD接入

* 除审核服流程外，其他功能接入完成。灰度发布测试由于打包策略调整还得做一轮验收测试。
* 下周可以开始灰度和审核服的验收测试。
* Vega在打包流程调整完毕后需要迁移到正式环境的Walle和Jenkins。
* RC缓存迁移方案讨论确定
  * mtool代码调整，rc流程调整@穆建辰推进。
  * eve代码调整@阎杨将，@杨光推进。

### 对接腾讯IDC

* 打包脚本中对CMDB的依赖已经完全移除, 生成cmdb相关配置的部分迁移到了天梯流程中。
* 打包脚本仓库(pipeline)仅保留了起停服的脚本。代码重构，测试完成。
* 天梯脚本适配腾讯CMDB数据格式开发，测试完成。重构了访问zookeeper的接口，今后对zookeeper的操作应该扩展现有的接口，避免重复造轮子。
* 天梯脚本功能整理，按照功能分组，希望能达到天梯流程更准确，使用更方便的目标。 下周完成vega项目目前所有天梯流程的整理。
* 服务器meta配置快速更新的需求可以通过仅发布服务端包实现。
* 用于打包流程，获取线上客户端版本信息的Online Version Service改造。
  * Online Version Service下线，功能迁移到其他线上服务中。
  * DK项目组使用notice服务获取线上版本，功能测试可用，Walle简单调整代码，配置数据就可用。
  * Vega项目组使用VMS服务获取线上版本，功能需要开发。
  * Walle支持手工传入线上版本打包的功能，应对VMS/Notice服务不可用的情况。

## Walle功能开发

* GIT/SVN版本对比功能已发布上线。
* Walle提供API为下游任务提供敏感参数，相关代码修改。-- 开发测试
* Walle K8s部署，Staging环境完成。
  * Walle的生产环境已经部署运行在K8s集群，https://walle4.youle.game 线上使用的实例已是容器化部署的成果。
  * Staging环境也已经使用，http://walle4-staging.172.16.152.100.xip.cloud 。
  * 发布流程: 开发分支合并Master -> 创建发布Tag -> 代码部署到Staging环境 -> 通过必要的测试后发布到Production环境。

## 内部项目容器化部署

* 本周完成了Wall4的容器化部署，Staging环境搭建。下周开始迁移天梯和CMDB。
* 后续完成DevOps内部其他项目，PDG项目容器化部署，Staging环境。

## 监控

* Prometheus联邦部署方案完成上线。
* 客户端打点数据指标监控，报警完成。

## 容灾

* 调研使用腾讯云，华为云MongoDB服务，支撑DK MongoDB容灾需求。
* Git/SVN备份，容灾方案确定。数据备份完成，数据恢复测试可用。[svn备份及恢复](https://git.youle.game/TC/TSD/OPS/documents/wikis/%E6%96%B0SVN%20%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D), [git备份及恢复](https://git.youle.game/TC/TSD/OPS/documents/wikis/GitLab%20%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D)
* Jenkins备份恢复方案调研中。

### 相关文档

* Jenkins任务组织方式调整, 已完成上线。[说明文档](https://git.youle.game/TC/TSD/DevOps/dune/wikis/jenkins_authorization)
* [CI/CD系统接入Step By Step文档](https://git.youle.game/TC/TSD/DevOps/dune/wikis/integrate_walle_step_by_step)
* GameStatic/Patch。[使用说明](https://git.youle.game/TC/TSD/DevOps/dune/wikis/Release-Note-v0.1.2)
* [服务器端灰度/审核服方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%90%8E%E7%AB%AF%E6%96%87%E6%A1%A3/appstore_review_and_gray)
* [客户端灰度发布方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%89%8D%E7%AB%AF%E6%96%87%E6%A1%A3/gray-server)
* [客户端审核服方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%89%8D%E7%AB%AF%E6%96%87%E6%A1%A3/apple-review-version)
* [svn备份及恢复](https://git.youle.game/TC/TSD/OPS/documents/wikis/%E6%96%B0SVN%20%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D)
* [git备份及恢复](https://git.youle.game/TC/TSD/OPS/documents/wikis/GitLab%20%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%81%A2%E5%A4%8D)

 