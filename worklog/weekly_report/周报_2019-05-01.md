# Walle项目周报

## Vega

### 初步接入 （2019-02-15 ~ 2019-03-08）

目标：Vega项目各业务功能模块接入CI；可以通过新系统出包，可以正常游戏。
进度：第一周基本完成CI接入，期间由于项目组对接SDK前端暂停了一周。第三周解决打包机和CI的细节问题；已经可以打出安装包，但是无法游戏。

### 高级功能接入 (2019-03-08 ~ 2019-04-13)

目标：完成灰度发布，热更新等高级功能的接入。
进度：

* ~~GameStatic~~
* ~~服务器热更新~~
* ~~灰度发布~~
  * ~~确定[灰度发布方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%89%8D%E7%AB%AF%E6%96%87%E6%A1%A3/gray-server)，客户端，服务端代码做了相应调整。~~
  * 客户端/服务端灰度测试：
    * ~~目前VMS没有判断客户端是否是灰度版本。判定是否灰度版本需要的信息在ZooKeeper配置中心保存，需要VMS代码做相应修改。~~
    * ~~天梯部署脚本第一步判断包版本的逻辑依赖eve，需要添加eve依赖到PYTHONPATH环境变量中。~~
    * Walle上已发布的灰度版本显示还是未部署 -- DevOps跟进
    * Walle上模块Tag是按照ID来排序的，存在连续打两个tag，后打的先完成，导致后打的Tag在排序上落后于先打的Tag。 -- DevOps跟进
    * VMS对兼容的客户端版本处理有问题，导致灰度客户端无法更新。-- 王贤蛟跟进
    * 客户端对VMS的请求在某些情况下传递的参数不够，导致客户端无法更新。 -- 穆建辰跟进
* ~~苹果审核服~~
  * ~~本周在临时的部署位置测试审核服发布成功。~~
  * ~~暴露出的天梯流程，Python依赖，世界服启动配置等问题下周解决，记录文档。~~
  * 发布审核服，托马斯把更新包推送到了按照部署位置区分的CDN目录，导致vms返回给前端的更新包地址不匹配。-- DevOps跟进
  * 审核服的发布操作，需要先发布审核服，再发布正式服。由于天梯流程执行在不同的部署位置，不能串联起来，容易忘记导致出错。 -- DevOps跟进
  * 周六vega-cdn.youle,.com CDN服务出现问题，调查发现是NCC相关CDN资源回收导致整个CDN服务失效。-- DevOps跟进
  * 测试过程中暴露出：天梯流程编排需要了解游戏服务流程和细节，OPS需要主动从项目组了解和跟进设计的变更，提高整个团队的工作效率。-- 杨光/王贤蛟/孙亮总结问题
* RC缓存迁移
  * 和曲宁同步方案，缓存迁移的工作因支持DK接入SDK和iOS更新暂缓2周。
  * C++编译无法利用cache的问题，解楠楠提供了解决方案，下周DevOps配合对Jenkins做调整。

### Walle问题反馈

Vega4月初对Walle做了一轮验收测试，提供了一些问题反馈，DevOps安排时间开发.

* ~~提供发布包/集群搜索和过滤功能。~~
* ~~全部锁定后可以全部解锁~~
* ~~构建信息页上的英文换成中文。Json调整format，对用户更友好一点。分Table显示。~~
* ~~提供历史包在CDN上地址的列表。~~
* 需要⽀持可重复发布某个版本 -- 开发中
* 锁定了的模块，在切换版本时保持锁定状态 -- 开发中
* 版本对比 -- 测试部张军有同样的需求并已经开发了一些功能，后续同步需求。
* 在构建版本时，可以快速编辑升级序列和部署位置的关系。-- Walle有相似的功能，需要和李栋梁确认需求。
* 部署位置集群的状态 -- Walle有相似的功能，需要和李栋梁确认需求。

### 相关文档

* Jenkins任务组织方式调整, 已完成上线。[说明文档](https://git.youle.game/TC/TSD/DevOps/dune/wikis/jenkins_authorization)
* [CI/CD系统接入Step By Step文档](https://git.youle.game/TC/TSD/DevOps/dune/wikis/integrate_walle_step_by_step)
* GameStatic/Patch。[使用说明](https://git.youle.game/TC/TSD/DevOps/dune/wikis/Release-Note-v0.1.2)
* [服务器端灰度/审核服方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%90%8E%E7%AB%AF%E6%96%87%E6%A1%A3/appstore_review_and_gray)
* [客户端灰度发布方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%89%8D%E7%AB%AF%E6%96%87%E6%A1%A3/gray-server)
* [客户端审核服方案](https://git.youle.game/TC/TSD/DevOps/dune/wikis/%E5%89%8D%E7%AB%AF%E6%96%87%E6%A1%A3/apple-review-version)